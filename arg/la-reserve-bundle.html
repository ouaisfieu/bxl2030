<!DOCTYPE html>
<html lang="fr" data-theme="sombre" data-typography="elegant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>LA R√âSERVE ‚Äî Syst√®me de D√©tournement Administratif</title>
    <meta name="description" content="Ce qui existe d√©j√† mais n'a jamais √©t√© reconnu. ARG participatif.">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@400;500;700&family=Fira+Code&family=Syne:wght@400;700;800&family=VT323&family=Press+Start+2P&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
/* ============================================
   LA R√âSERVE - UNIFIED STYLES
   ============================================ */

/* Variables */
:root {
    --bg-primary: #1a1a2e;
    --bg-secondary: #16213e;
    --bg-card: #252540;
    --bg-input: #1e1e35;
    --text-primary: #e8e8f0;
    --text-secondary: #a8a8c0;
    --text-muted: #6b6b80;
    --accent-1: #7c3aed;
    --accent-1-light: #a78bfa;
    --accent-2: #06b6d4;
    --border-light: rgba(255,255,255,0.1);
    --gradient: linear-gradient(135deg, var(--accent-1), var(--accent-2));
    --shadow: 0 4px 20px rgba(0,0,0,0.3);
    --radius: 12px;
    --radius-sm: 8px;
    --sidebar-width: 260px;
    --font-display: 'Playfair Display', serif;
    --font-body: 'DM Sans', sans-serif;
    --font-mono: 'Fira Code', monospace;
    --terminal-green: #00ff41;
    --terminal-amber: #ffb000;
    --terminal-red: #ff0040;
}

/* Themes */
[data-theme="clair"] {
    --bg-primary: #f8f9fa; --bg-secondary: #fff; --bg-card: #fff; --bg-input: #fff;
    --text-primary: #212529; --text-secondary: #495057; --text-muted: #868e96;
    --border-light: rgba(0,0,0,0.1);
}
[data-theme="neon"] {
    --bg-primary: #0a0a0f; --bg-secondary: #12121a; --bg-card: #0f0f18;
    --text-secondary: #00ff88; --accent-1: #00ff88; --accent-2: #ff0080;
}
[data-theme="retrogeek"] {
    --bg-primary: #2b1b3d; --bg-secondary: #3d2a5a; --bg-card: #352650;
    --text-primary: #ffd700; --text-secondary: #ff9500; --accent-1: #00ff00; --accent-2: #ff6600;
    --font-display: 'Press Start 2P', cursive;
}
[data-theme="console"] {
    --bg-primary: #0c0c0c; --bg-secondary: #1a1a1a; --bg-card: #141414;
    --text-primary: #00ff00; --text-secondary: #00cc00; --accent-1: #00ff00;
    --font-display: 'VT323', monospace; --font-body: 'Fira Code', monospace;
}
[data-theme="warroom"] {
    --bg-primary: #0a0a0a; --bg-secondary: #001100; --bg-card: rgba(0,20,0,0.8);
    --text-primary: #00ff41; --text-secondary: #00aa2a; --accent-1: #00ff41; --accent-2: #ffb000;
    --font-display: 'Orbitron', sans-serif; --font-body: 'Share Tech Mono', monospace;
}

/* Typography */
[data-typography="editorial"] { --font-display: 'Syne', sans-serif; }
[data-typography="literary"] { --font-display: 'Playfair Display', serif; }
[data-typography="raw"] { --font-display: 'Fira Code', monospace; --font-body: 'Fira Code', monospace; }

/* Reset */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
    font-family: var(--font-body);
    font-size: 16px;
    line-height: 1.6;
    color: var(--text-primary);
    background: var(--bg-primary);
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
}
h1, h2, h3, h4 { font-family: var(--font-display); line-height: 1.2; }
a { color: var(--accent-1); text-decoration: none; }
::selection { background: var(--accent-1); color: #fff; }

/* Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-secondary); }
::-webkit-scrollbar-thumb { background: var(--accent-1); border-radius: 4px; }

/* Layout */
.app-container { display: flex; min-height: 100vh; }

/* Sidebar */
.sidebar {
    position: fixed; top: 0; left: 0; width: var(--sidebar-width); height: 100vh;
    background: var(--bg-secondary); border-right: 1px solid var(--border-light);
    display: flex; flex-direction: column; z-index: 100; transition: transform 0.3s;
}
.sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--border-light); }
.logo {
    font-family: var(--font-display); font-size: 1.2rem; font-weight: 700;
    background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.sidebar-nav { flex: 1; padding: 1rem 0; overflow-y: auto; }
.nav-section { margin-bottom: 1.5rem; }
.nav-section-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); padding: 0 1.5rem; margin-bottom: 0.5rem; }
.nav-item {
    display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.5rem;
    color: var(--text-secondary); cursor: pointer; border-left: 3px solid transparent; transition: all 0.2s;
}
.nav-item:hover { background: rgba(124,58,237,0.1); color: var(--text-primary); }
.nav-item.active { background: rgba(124,58,237,0.15); color: var(--accent-1); border-left-color: var(--accent-1); }
.nav-icon { font-size: 1.1rem; width: 24px; text-align: center; }
.nav-item .badge { margin-left: auto; padding: 0.1rem 0.5rem; font-size: 0.7rem; background: var(--accent-1); color: #fff; border-radius: 10px; }

/* Main */
.main-content { flex: 1; margin-left: var(--sidebar-width); min-height: 100vh; display: flex; flex-direction: column; }
.main-header {
    position: sticky; top: 0; display: flex; align-items: center; justify-content: space-between;
    padding: 1rem 2rem; background: var(--bg-primary); border-bottom: 1px solid var(--border-light);
    z-index: 50; backdrop-filter: blur(10px);
}
.header-title { font-size: 1.5rem; }
.header-actions { display: flex; gap: 1rem; }
.content-area { flex: 1; padding: 2rem; max-width: 1400px; width: 100%; margin: 0 auto; }

/* Views */
.view { display: none; }
.view.active { display: block; animation: fadeIn 0.3s; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Hero */
.hero {
    background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(6,182,212,0.1));
    border: 1px solid var(--border-light); border-radius: var(--radius); padding: 3rem; text-align: center; margin-bottom: 2rem;
}
.hero h1 { font-size: 2.5rem; margin-bottom: 1rem; }
.hero p { color: var(--text-secondary); margin-bottom: 1.5rem; }
.warroom-hero { background: linear-gradient(135deg, rgba(0,255,65,0.1), rgba(0,0,0,0.5)); }

/* Buttons */
.btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
    padding: 0.75rem 1.5rem; font-size: 0.9rem; font-weight: 500; border: none;
    border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;
}
.btn-primary { background: var(--gradient); color: #fff; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 20px rgba(124,58,237,0.4); }
.btn-secondary { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border-light); }
.btn-ghost { background: transparent; color: var(--text-secondary); }
.btn-ghost:hover { background: rgba(124,58,237,0.1); color: var(--accent-1); }
.btn-danger { background: #ef4444; color: #fff; }
.btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
.btn-lg { padding: 1rem 2rem; font-size: 1rem; }

/* Cards */
.card {
    background: var(--bg-card); border: 1px solid var(--border-light);
    border-radius: var(--radius); padding: 1.5rem; transition: all 0.2s;
}
.card:hover { border-color: var(--accent-1); }
.card h3 { margin-bottom: 1rem; }

/* Forms */
.form-group { margin-bottom: 1.25rem; }
.form-group label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary); }
.form-input {
    width: 100%; padding: 0.75rem 1rem; font-size: 0.95rem; color: var(--text-primary);
    background: var(--bg-input); border: 1px solid var(--border-light); border-radius: var(--radius-sm);
    font-family: inherit; transition: all 0.2s;
}
.form-input:focus { outline: none; border-color: var(--accent-1); box-shadow: 0 0 0 3px rgba(124,58,237,0.2); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

/* Badges */
.badge { display: inline-block; padding: 0.2rem 0.6rem; font-size: 0.75rem; border-radius: 20px; }
.badge-complice { background: rgba(139,92,246,0.2); color: #a78bfa; }
.badge-figurant { background: rgba(6,182,212,0.2); color: #67e8f9; }
.badge-temoin { background: rgba(245,158,11,0.2); color: #fbbf24; }
.badge-expert { background: rgba(16,185,129,0.2); color: #34d399; }

/* Tabs */
.tab {
    padding: 0.75rem 1rem; font-size: 0.85rem; color: var(--text-secondary);
    background: transparent; border: none; cursor: pointer; border-radius: var(--radius-sm); transition: all 0.2s;
}
.tab:hover { color: var(--text-primary); }
.tab.active { background: var(--bg-card); color: var(--accent-1); }
.tab-content { display: none; }
.tab-content.active { display: block; }

/* Grid */
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
.stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem; }
@media (max-width: 900px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }

/* Stats */
.stat-card { background: var(--bg-card); border: 1px solid var(--border-light); border-radius: var(--radius); padding: 1.5rem; text-align: center; }
.stat-value { font-family: var(--font-display); font-size: 2.5rem; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.stat-label { font-size: 0.85rem; color: var(--text-muted); }

/* Editor */
.editor-layout { display: grid; grid-template-columns: 1fr 380px; gap: 2rem; }
@media (max-width: 1100px) { .editor-layout { grid-template-columns: 1fr; } }
.editor-panel { background: var(--bg-card); border: 1px solid var(--border-light); border-radius: var(--radius); overflow: hidden; }
.editor-tabs { display: flex; padding: 0.5rem; background: var(--bg-secondary); border-bottom: 1px solid var(--border-light); }
.editor-body { padding: 1.5rem; }

/* Markdown */
.md-toolbar { display: flex; gap: 0.25rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: var(--radius-sm); margin-bottom: 0.5rem; }
.md-btn { width: 32px; height: 32px; background: transparent; border: none; color: var(--text-secondary); cursor: pointer; border-radius: 4px; }
.md-btn:hover { background: rgba(124,58,237,0.2); color: var(--accent-1); }
.md-editor { min-height: 200px; font-family: var(--font-mono); }

/* Preview */
.preview-panel { position: sticky; top: 80px; }
.preview-header { display: flex; justify-content: space-between; padding: 1rem; background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius) var(--radius) 0 0; }
.preview-frame { border: 1px solid var(--border-light); border-top: none; background: #fff; border-radius: 0 0 var(--radius) var(--radius); overflow: hidden; }
.preview-frame iframe { width: 100%; height: 350px; border: none; }
.preview-actions { display: flex; gap: 0.5rem; margin-top: 1rem; }
.preview-actions .btn { flex: 1; }

/* List items */
.list { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem; }
.list-item {
    display: flex; align-items: center; gap: 1rem; padding: 1rem;
    background: var(--bg-secondary); border-radius: var(--radius-sm); border-left: 4px solid var(--accent-1);
}
.list-item-info { flex: 1; }
.list-item-title { font-weight: 500; }
.list-item-sub { font-size: 0.85rem; color: var(--text-muted); }

/* Timeline */
.timeline { position: relative; padding-left: 2rem; margin-top: 1rem; }
.timeline::before { content: ''; position: absolute; left: 7px; top: 0; bottom: 0; width: 2px; background: var(--border-light); }
.timeline-item { position: relative; padding-bottom: 1.5rem; }
.timeline-dot { position: absolute; left: -2rem; top: 0; width: 16px; height: 16px; background: var(--accent-1); border: 3px solid var(--bg-card); border-radius: 50%; }
.timeline-content { padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-sm); }
.timeline-date { font-size: 0.8rem; color: var(--text-muted); }

/* Files */
.file-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.75rem; margin-top: 1rem; }
.file-btn {
    display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 1rem;
    background: var(--bg-secondary); border: 1px solid var(--border-light); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;
}
.file-btn:hover { border-color: var(--accent-1); transform: translateY(-2px); }
.file-icon { font-size: 1.5rem; }
.file-label { font-size: 0.75rem; color: var(--text-secondary); }

/* Settings */
.settings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
.theme-grid, .typo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 1rem; }
.theme-option, .typo-option {
    padding: 0.75rem; text-align: center; background: var(--bg-secondary);
    border: 2px solid transparent; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;
}
.theme-option:hover, .typo-option:hover { border-color: var(--accent-1); }
.theme-option.active, .typo-option.active { border-color: var(--accent-1); background: rgba(124,58,237,0.1); }
.theme-preview { height: 30px; border-radius: 4px; margin-bottom: 0.5rem; }
.theme-name, .typo-name { font-size: 0.8rem; }

/* Modal */
.modal-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7);
    display: flex; align-items: center; justify-content: center; z-index: 1000;
    opacity: 0; visibility: hidden; transition: all 0.3s;
}
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal { background: var(--bg-card); border-radius: var(--radius); width: 90%; max-width: 500px; transform: scale(0.9); transition: transform 0.3s; }
.modal-overlay.active .modal { transform: scale(1); }
.modal-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-light); }
.modal-close { width: 32px; height: 32px; background: var(--bg-secondary); border: none; border-radius: 50%; cursor: pointer; color: var(--text-muted); }
.modal-body { padding: 1.5rem; }
.modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border-light); text-align: right; }

/* Toast */
.toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 2000; display: flex; flex-direction: column; gap: 0.5rem; }
.toast { display: flex; gap: 0.75rem; padding: 1rem; background: var(--bg-card); border-radius: var(--radius-sm); box-shadow: var(--shadow); animation: toastIn 0.3s; }
.toast.success { border-left: 4px solid #10b981; }
.toast.error { border-left: 4px solid #ef4444; }
@keyframes toastIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* War Room */
.warroom-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #000; z-index: 5000; display: none; }
.warroom-overlay.active { display: block; }
.warroom-overlay::before {
    content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);
    pointer-events: none; z-index: 5001;
}

/* Guide */
.guide { max-width: 800px; margin: 0 auto; line-height: 1.8; }
.guide h1 { font-size: 2rem; margin-bottom: 1.5rem; }
.guide h2 { font-size: 1.5rem; margin: 2rem 0 1rem; color: var(--accent-1); }
.guide h3 { font-size: 1.2rem; margin: 1.5rem 0 0.75rem; }
.guide p { margin-bottom: 1rem; color: var(--text-secondary); }
.guide ul { margin: 1rem 0; padding-left: 2rem; }
.guide li { margin-bottom: 0.5rem; }
.guide blockquote { border-left: 4px solid var(--accent-1); padding-left: 1rem; font-style: italic; margin: 1.5rem 0; }

/* Utils */
.flex-between { display: flex; justify-content: space-between; align-items: center; }
.empty-state { text-align: center; padding: 3rem; color: var(--text-muted); }
.empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }

/* Mobile */
.menu-toggle {
    display: none; position: fixed; bottom: 1rem; right: 1rem; width: 56px; height: 56px;
    background: var(--gradient); border: none; border-radius: 50%; color: #fff; font-size: 1.5rem;
    cursor: pointer; z-index: 200; box-shadow: var(--shadow);
}

@media (max-width: 1024px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .main-content { margin-left: 0; }
    .menu-toggle { display: flex; align-items: center; justify-content: center; }
    .grid-2 { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
    .hero { padding: 2rem 1rem; }
    .hero h1 { font-size: 1.75rem; }
    .content-area { padding: 1rem; }
    .form-row { grid-template-columns: 1fr; }
}

/* Animations */
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
@keyframes glow { 0%, 100% { box-shadow: 0 0 5px var(--accent-1); } 50% { box-shadow: 0 0 20px var(--accent-1); } }

/* Console theme extras */
[data-theme="console"] .card, [data-theme="console"] .btn { border-radius: 0; }
[data-theme="console"] body::after {
    content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.1) 2px, rgba(0,0,0,0.1) 4px);
    pointer-events: none; z-index: 9999;
}

/* Neon glow */
[data-theme="neon"] .logo, [data-theme="neon"] h1 { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor; }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header"><div class="logo">LA R√âSERVE</div></div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Navigation</div>
                    <div class="nav-item active" data-view="dashboard"><span class="nav-icon">üè†</span>Tableau de bord</div>
                    <div class="nav-item" data-view="create"><span class="nav-icon">‚úèÔ∏è</span>Cr√©er une action</div>
                    <div class="nav-item" data-view="actions"><span class="nav-icon">üìã</span>Mes actions<span class="badge" id="actionsCount">0</span></div>
                    <div class="nav-item" data-view="files"><span class="nav-icon">üìÅ</span>Fichiers</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Outils</div>
                    <div class="nav-item" data-view="warroom"><span class="nav-icon">üéõÔ∏è</span>War Room</div>
                    <div class="nav-item" data-view="guide"><span class="nav-icon">üìñ</span>Guide</div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Param√®tres</div>
                    <div class="nav-item" data-view="settings"><span class="nav-icon">‚öôÔ∏è</span>Pr√©f√©rences</div>
                </div>
            </nav>
        </aside>
        <main class="main-content">
            <header class="main-header">
                <h1 class="header-title" id="viewTitle">Tableau de bord</h1>
                <div class="header-actions">
                    <button class="btn btn-ghost" id="themeToggle">üé®</button>
                    <button class="btn btn-primary" id="newActionBtn">+ Nouvelle action</button>
                </div>
            </header>
            <div class="content-area">
                <div class="view active" id="view-dashboard">
                    <div class="hero"><h1>Bienvenue dans La R√©serve</h1><p>¬´ Ce qui existe d√©j√† mais n'a jamais √©t√© reconnu ¬ª</p><button class="btn btn-primary btn-lg" onclick="showView('create')">‚úèÔ∏è Cr√©er ma premi√®re action</button></div>
                    <div class="stats-grid" id="statsGrid"></div>
                    <div class="recent-list" id="recentList"></div>
                </div>
                <div class="view" id="view-create">
                    <div class="editor-layout">
                        <div class="editor-panel">
                            <div class="editor-tabs">
                                <button class="tab active" data-tab="info">üìã Infos</button>
                                <button class="tab" data-tab="content">üìù Contenu</button>
                                <button class="tab" data-tab="recrues">üë• Recrues</button>
                                <button class="tab" data-tab="timeline">üìÖ Timeline</button>
                            </div>
                            <div class="editor-body">
                                <div class="tab-content active" id="tab-info">
                                    <div class="form-group"><label>Titre *</label><input type="text" id="actionTitle" class="form-input" placeholder="Ex: Op√©ration Silence FOREM"></div>
                                    <div class="form-row"><div class="form-group"><label>Pseudo</label><input type="text" id="actionPseudo" class="form-input"></div><div class="form-group"><label>Lieu</label><input type="text" id="actionLieu" class="form-input"></div></div>
                                    <div class="form-row"><div class="form-group"><label>Type</label><select id="actionType" class="form-input"><option value="detournement">D√©tournement</option><option value="infiltration">Infiltration</option><option value="performance">Performance</option><option value="documentation">Documentation</option></select></div><div class="form-group"><label>Statut</label><select id="actionStatut" class="form-input"><option value="brouillon">üîò Brouillon</option><option value="planifie">üìÖ Planifi√©</option><option value="en_cours">‚ö° En cours</option><option value="complete">‚úÖ Compl√©t√©</option><option value="bascule">üåü Bascul√©</option></select></div></div>
                                    <div class="form-group"><label>Cible</label><input type="text" id="actionCible" class="form-input" placeholder="FOREM, VDAB..."></div>
                                </div>
                                <div class="tab-content" id="tab-content">
                                    <div class="form-group"><label>Description (Markdown)</label><div class="md-toolbar"><button class="md-btn" data-md="bold">B</button><button class="md-btn" data-md="italic">I</button><button class="md-btn" data-md="heading">H</button><button class="md-btn" data-md="list">‚ò∞</button><button class="md-btn" data-md="link">üîó</button></div><textarea id="actionDescription" class="form-input md-editor" rows="10" placeholder="D√©crivez votre action..."></textarea></div>
                                    <div class="form-group"><label>Manifeste</label><textarea id="actionManifeste" class="form-input" rows="3" placeholder="Le message cl√©..."></textarea></div>
                                </div>
                                <div class="tab-content" id="tab-recrues"><div class="flex-between"><span>Recrues (max 9)</span><button class="btn btn-primary btn-sm" id="addRecrueBtn">+ Ajouter</button></div><div class="list" id="recruesList"></div></div>
                                <div class="tab-content" id="tab-timeline"><div class="flex-between"><span>Timeline</span><button class="btn btn-primary btn-sm" id="addEventBtn">+ Ajouter</button></div><div class="timeline" id="timelineList"></div></div>
                            </div>
                        </div>
                        <div class="preview-panel">
                            <div class="preview-header"><span>üëÅÔ∏è Aper√ßu</span><button class="btn btn-ghost btn-sm" id="fullPreviewBtn">‚§¢</button></div>
                            <div class="preview-frame"><iframe id="previewIframe"></iframe></div>
                            <div class="preview-actions"><button class="btn btn-primary" id="saveBtn">üíæ Sauvegarder</button><button class="btn btn-secondary" id="exportBtn">üì§ Exporter</button></div>
                        </div>
                    </div>
                </div>
                <div class="view" id="view-actions"><div class="toolbar"><input type="text" id="searchInput" class="form-input" placeholder="üîç Rechercher..."></div><div class="grid" id="actionsGrid"></div></div>
                <div class="view" id="view-files"><div class="grid-2"><div class="card"><h3>üì• Importer</h3><div class="file-grid" id="importGrid"></div></div><div class="card"><h3>üì§ Exporter</h3><div class="file-grid" id="exportGrid"></div></div></div></div>
                <div class="view" id="view-warroom"><div class="hero warroom-hero"><h1>üéõÔ∏è War Room</h1><p>Centre de commandement tactique</p><button class="btn btn-primary btn-lg" onclick="launchWarRoom()">‚ö° Activer</button></div><div class="stats-grid warroom-stats" id="warroomStats"></div></div>
                <div class="view" id="view-guide"><article class="guide" id="guideContent"></article></div>
                <div class="view" id="view-settings"><div class="settings-grid"><div class="card"><h3>üé® Th√®me</h3><div class="theme-grid" id="themeGrid"></div></div><div class="card"><h3>‚úíÔ∏è Typographie</h3><div class="typo-grid" id="typoGrid"></div></div><div class="card"><h3>üíæ Donn√©es</h3><button class="btn btn-secondary" onclick="exportAll()">üì§ Exporter tout</button><button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Effacer tout</button></div></div></div>
            </div>
        </main>
    </div>
    <button class="menu-toggle" id="menuToggle">‚ò∞</button>
    <div class="toast-container" id="toastContainer"></div>
    <div class="modal-overlay" id="recrueModal"><div class="modal"><div class="modal-header"><h3>üë§ Ajouter une recrue</h3><button class="modal-close" onclick="closeModal('recrueModal')">√ó</button></div><div class="modal-body"><div class="form-group"><label>Nom</label><input type="text" id="recrueName" class="form-input"></div><div class="form-group"><label>Type</label><select id="recrueType" class="form-input"><option value="complice">üü£ Complice</option><option value="figurant">üîµ Figurant¬∑e</option><option value="temoin">üü° T√©moin</option><option value="expert">üü¢ Expert¬∑e</option></select></div><div class="form-group"><label>R√¥le</label><input type="text" id="recrueRole" class="form-input"></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveRecrue()">Ajouter</button></div></div></div>
    <div class="modal-overlay" id="eventModal"><div class="modal"><div class="modal-header"><h3>üìÖ Ajouter un √©v√©nement</h3><button class="modal-close" onclick="closeModal('eventModal')">√ó</button></div><div class="modal-body"><div class="form-group"><label>Date</label><input type="date" id="eventDate" class="form-input"></div><div class="form-group"><label>Titre</label><input type="text" id="eventTitle" class="form-input"></div><div class="form-group"><label>Description</label><textarea id="eventDesc" class="form-input" rows="2"></textarea></div></div><div class="modal-footer"><button class="btn btn-primary" onclick="saveEvent()">Ajouter</button></div></div></div>
    <div class="warroom-overlay" id="warroomOverlay"></div>
    <script>
/* ============================================
   LA R√âSERVE - UNIFIED APPLICATION
   ============================================ */

// State
const state = {
    view: 'dashboard',
    actions: JSON.parse(localStorage.getItem('lr-actions') || '[]'),
    recrues: [],
    timeline: [],
    editingId: null,
    theme: localStorage.getItem('lr-theme') || 'sombre',
    typo: localStorage.getItem('lr-typo') || 'elegant'
};

// Init
document.addEventListener('DOMContentLoaded', () => {
    applyTheme(state.theme);
    applyTypo(state.typo);
    initNav();
    initEditor();
    initSettings();
    initFiles();
    renderDashboard();
    renderGuide();
    console.log('üé≠ La R√©serve initialis√©e');
});

// Navigation
function initNav() {
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => showView(item.dataset.view));
    });
    document.getElementById('menuToggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('open');
    });
    document.getElementById('newActionBtn').addEventListener('click', () => {
        resetEditor();
        showView('create');
    });
    document.getElementById('themeToggle').addEventListener('click', cycleTheme);
}

function showView(view) {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.view === view));
    document.querySelectorAll('.view').forEach(v => v.classList.toggle('active', v.id === `view-${view}`));
    document.getElementById('viewTitle').textContent = {
        dashboard: 'Tableau de bord', create: 'Cr√©er une action', actions: 'Mes actions',
        files: 'Fichiers', warroom: 'War Room', guide: 'Guide', settings: 'Pr√©f√©rences'
    }[view] || view;
    document.getElementById('sidebar').classList.remove('open');
    state.view = view;
    if (view === 'create') updatePreview();
    if (view === 'actions') renderActions();
    if (view === 'warroom') renderWarroomStats();
}

// Dashboard
function renderDashboard() {
    const total = state.actions.length;
    const recrues = state.actions.reduce((s, a) => s + (a.recrues?.length || 0), 0);
    const bascule = state.actions.filter(a => a.statut === 'bascule').length;
    
    document.getElementById('statsGrid').innerHTML = `
        <div class="stat-card"><div class="stat-value">${total}</div><div class="stat-label">Actions</div></div>
        <div class="stat-card"><div class="stat-value">${recrues}</div><div class="stat-label">Recrues</div></div>
        <div class="stat-card"><div class="stat-value">${bascule}</div><div class="stat-label">Bascul√©es</div></div>
        <div class="stat-card"><div class="stat-value">${Math.min(100, Math.round(total * 2))}%</div><div class="stat-label">Progression</div></div>
    `;
    
    const recent = [...state.actions].sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt)).slice(0, 5);
    document.getElementById('recentList').innerHTML = recent.length ? `
        <div class="card"><h3>Actions r√©centes</h3>
        ${recent.map(a => `
            <div class="list-item" onclick="editAction('${a.id}')" style="cursor:pointer">
                <span>üìÑ</span>
                <div class="list-item-info">
                    <div class="list-item-title">${esc(a.titre || 'Sans titre')}</div>
                    <div class="list-item-sub">${a.cible || ''} ‚Ä¢ ${formatDate(a.updatedAt)}</div>
                </div>
                <span class="badge">${a.statut}</span>
            </div>
        `).join('')}
        </div>
    ` : '';
    
    document.getElementById('actionsCount').textContent = total;
}

// Editor
function initEditor() {
    // Tabs
    document.querySelectorAll('.editor-tabs .tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.editor-tabs .tab').forEach(t => t.classList.toggle('active', t === tab));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === `tab-${tab.dataset.tab}`));
        });
    });
    
    // Markdown
    document.querySelectorAll('.md-btn').forEach(btn => {
        btn.addEventListener('click', () => insertMd(btn.dataset.md));
    });
    
    // Auto preview
    ['actionTitle', 'actionDescription', 'actionManifeste'].forEach(id => {
        document.getElementById(id)?.addEventListener('input', debounce(updatePreview, 500));
    });
    
    // Buttons
    document.getElementById('addRecrueBtn').addEventListener('click', () => openModal('recrueModal'));
    document.getElementById('addEventBtn').addEventListener('click', () => {
        document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
        openModal('eventModal');
    });
    document.getElementById('saveBtn').addEventListener('click', saveAction);
    document.getElementById('exportBtn').addEventListener('click', () => exportAction('html'));
    document.getElementById('fullPreviewBtn').addEventListener('click', openFullPreview);
}

function resetEditor() {
    state.editingId = null;
    state.recrues = [];
    state.timeline = [];
    ['actionTitle', 'actionPseudo', 'actionLieu', 'actionCible', 'actionDescription', 'actionManifeste'].forEach(id => {
        document.getElementById(id).value = '';
    });
    document.getElementById('actionType').value = 'detournement';
    document.getElementById('actionStatut').value = 'brouillon';
    renderRecrues();
    renderTimeline();
    updatePreview();
}

function getFormData() {
    return {
        id: state.editingId || genId(),
        titre: document.getElementById('actionTitle').value,
        pseudo: document.getElementById('actionPseudo').value,
        lieu: document.getElementById('actionLieu').value,
        type: document.getElementById('actionType').value,
        statut: document.getElementById('actionStatut').value,
        cible: document.getElementById('actionCible').value,
        description: document.getElementById('actionDescription').value,
        manifeste: document.getElementById('actionManifeste').value,
        recrues: state.recrues,
        timeline: state.timeline,
        createdAt: state.editingId ? state.actions.find(a => a.id === state.editingId)?.createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
    };
}

function fillForm(data) {
    state.editingId = data.id;
    state.recrues = data.recrues || [];
    state.timeline = data.timeline || [];
    document.getElementById('actionTitle').value = data.titre || '';
    document.getElementById('actionPseudo').value = data.pseudo || '';
    document.getElementById('actionLieu').value = data.lieu || '';
    document.getElementById('actionType').value = data.type || 'detournement';
    document.getElementById('actionStatut').value = data.statut || 'brouillon';
    document.getElementById('actionCible').value = data.cible || '';
    document.getElementById('actionDescription').value = data.description || '';
    document.getElementById('actionManifeste').value = data.manifeste || '';
    renderRecrues();
    renderTimeline();
    updatePreview();
}

function saveAction() {
    const data = getFormData();
    if (!data.titre.trim()) return toast('Titre requis', 'error');
    
    const idx = state.actions.findIndex(a => a.id === data.id);
    if (idx >= 0) state.actions[idx] = data;
    else state.actions.push(data);
    
    localStorage.setItem('lr-actions', JSON.stringify(state.actions));
    renderDashboard();
    toast('Action sauvegard√©e!', 'success');
}

// Recrues
function renderRecrues() {
    const el = document.getElementById('recruesList');
    if (!state.recrues.length) {
        el.innerHTML = '<div class="empty-state"><div class="empty-icon">üë•</div>Aucune recrue</div>';
        return;
    }
    const icons = { complice: 'üü£', figurant: 'üîµ', temoin: 'üü°', expert: 'üü¢' };
    el.innerHTML = state.recrues.map((r, i) => `
        <div class="list-item" style="border-left-color: var(--accent-${r.type === 'complice' ? '1' : '2'})">
            <span>${icons[r.type] || 'üë§'}</span>
            <div class="list-item-info">
                <div class="list-item-title">${esc(r.name)}</div>
                <div class="list-item-sub">${esc(r.role)}</div>
            </div>
            <span class="badge badge-${r.type}">${r.type}</span>
            <button class="btn btn-ghost btn-sm" onclick="deleteRecrue(${i})">üóëÔ∏è</button>
        </div>
    `).join('');
}

function saveRecrue() {
    const name = document.getElementById('recrueName').value.trim();
    const type = document.getElementById('recrueType').value;
    const role = document.getElementById('recrueRole').value.trim();
    if (!name) return toast('Nom requis', 'error');
    if (state.recrues.length >= 9) return toast('Max 9 recrues', 'error');
    
    state.recrues.push({ name, type, role });
    renderRecrues();
    updatePreview();
    closeModal('recrueModal');
    document.getElementById('recrueName').value = '';
    document.getElementById('recrueRole').value = '';
}

function deleteRecrue(i) {
    state.recrues.splice(i, 1);
    renderRecrues();
    updatePreview();
}

// Timeline
function renderTimeline() {
    const el = document.getElementById('timelineList');
    if (!state.timeline.length) {
        el.innerHTML = '<div class="empty-state"><div class="empty-icon">üìÖ</div>Timeline vide</div>';
        el.className = 'list';
        return;
    }
    el.className = 'timeline';
    const sorted = [...state.timeline].sort((a, b) => new Date(a.date) - new Date(b.date));
    el.innerHTML = sorted.map((e, i) => `
        <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <div class="timeline-date">${formatDate(e.date)}</div>
                <strong>${esc(e.title)}</strong>
                ${e.desc ? `<p style="font-size:0.85rem;color:var(--text-muted);margin-top:0.5rem">${esc(e.desc)}</p>` : ''}
                <button class="btn btn-ghost btn-sm" onclick="deleteEvent(${i})" style="margin-top:0.5rem">üóëÔ∏è</button>
            </div>
        </div>
    `).join('');
}

function saveEvent() {
    const date = document.getElementById('eventDate').value;
    const title = document.getElementById('eventTitle').value.trim();
    const desc = document.getElementById('eventDesc').value.trim();
    if (!date || !title) return toast('Date et titre requis', 'error');
    
    state.timeline.push({ date, title, desc });
    renderTimeline();
    updatePreview();
    closeModal('eventModal');
    document.getElementById('eventTitle').value = '';
    document.getElementById('eventDesc').value = '';
}

function deleteEvent(i) {
    state.timeline.splice(i, 1);
    renderTimeline();
    updatePreview();
}

// Preview
function updatePreview() {
    const data = getFormData();
    document.getElementById('previewIframe').srcdoc = generateHTML(data);
}

function openFullPreview() {
    const html = generateHTML(getFormData());
    const w = window.open('', '_blank');
    w.document.write(html);
}

function generateHTML(d) {
    return `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
    <title>${esc(d.titre || 'Action')} ‚Äî La R√©serve</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'DM Sans',sans-serif;background:#1a1a2e;color:#e8e8f0;line-height:1.6;min-height:100vh;padding:2rem}
    .container{max-width:800px;margin:0 auto}
    .header{text-align:center;margin-bottom:2rem}
    .logo{font-size:0.9rem;color:#7c3aed;letter-spacing:0.2em;margin-bottom:1rem}
    h1{font-family:'Playfair Display',serif;font-size:2rem;margin-bottom:1rem}
    .meta{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;color:#a8a8c0;font-size:0.9rem}
    .badge{padding:0.25rem 0.75rem;background:#7c3aed;color:#fff;border-radius:20px;font-size:0.75rem}
    .section{background:#252540;border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem}
    .section h2{font-size:1.1rem;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem}
    blockquote{font-size:1.1rem;font-style:italic;text-align:center;padding:1.5rem;border-left:4px solid #7c3aed;margin-bottom:1.5rem}
    .recrue{display:flex;align-items:center;gap:1rem;padding:0.75rem;background:rgba(255,255,255,0.05);border-radius:8px;margin-bottom:0.5rem}
    .timeline-item{position:relative;padding-left:2rem;padding-bottom:1.5rem;border-left:2px solid rgba(255,255,255,0.1)}
    .timeline-dot{position:absolute;left:-6px;top:0;width:10px;height:10px;background:#7c3aed;border-radius:50%}
    .footer{text-align:center;margin-top:2rem;padding-top:1.5rem;border-top:1px solid rgba(255,255,255,0.1);font-size:0.85rem;color:#6b6b80}
    </style></head><body>
    <div class="container">
    <header class="header"><div class="logo">LA R√âSERVE</div><h1>${esc(d.titre || 'Sans titre')}</h1>
    <div class="meta">${d.pseudo ? `<span>üë§ ${esc(d.pseudo)}</span>` : ''}${d.lieu ? `<span>üìç ${esc(d.lieu)}</span>` : ''}${d.cible ? `<span>üéØ ${esc(d.cible)}</span>` : ''}<span class="badge">${d.statut}</span></div></header>
    ${d.manifeste ? `<blockquote>¬´ ${esc(d.manifeste)} ¬ª</blockquote>` : ''}
    ${d.description ? `<section class="section"><h2>üìù Description</h2><div>${parseMd(d.description)}</div></section>` : ''}
    ${d.recrues?.length ? `<section class="section"><h2>üë• Recrues (${d.recrues.length}/9)</h2>${d.recrues.map(r => `<div class="recrue"><span>${{complice:'üü£',figurant:'üîµ',temoin:'üü°',expert:'üü¢'}[r.type]||'üë§'}</span><div><strong>${esc(r.name)}</strong><div style="font-size:0.85rem;color:#a8a8c0">${esc(r.role)}</div></div></div>`).join('')}</section>` : ''}
    ${d.timeline?.length ? `<section class="section"><h2>üìÖ Timeline</h2><div style="padding-left:0.5rem">${[...d.timeline].sort((a,b)=>new Date(a.date)-new Date(b.date)).map(e => `<div class="timeline-item"><div class="timeline-dot"></div><div class="timeline-date" style="font-size:0.8rem;color:#6b6b80">${formatDate(e.date)}</div><strong>${esc(e.title)}</strong>${e.desc?`<p style="color:#a8a8c0;font-size:0.9rem">${esc(e.desc)}</p>`:''}</div>`).join('')}</div></section>` : ''}
    <footer class="footer"><p>Action ${d.id} ‚Äî La R√©serve</p><p>¬´ Ce qui existe d√©j√† mais n'a jamais √©t√© reconnu ¬ª</p></footer>
    </div></body></html>`;
}

// Actions list
function renderActions() {
    const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
    let filtered = state.actions;
    if (search) filtered = filtered.filter(a => a.titre?.toLowerCase().includes(search) || a.cible?.toLowerCase().includes(search));
    
    document.getElementById('actionsGrid').innerHTML = filtered.length ? filtered.map(a => `
        <div class="card" onclick="editAction('${a.id}')" style="cursor:pointer">
            <div class="flex-between" style="margin-bottom:0.75rem">
                <h3 style="font-size:1.1rem">${esc(a.titre || 'Sans titre')}</h3>
                <span class="badge">${a.statut}</span>
            </div>
            <p style="font-size:0.9rem;color:var(--text-muted);margin-bottom:1rem">${esc((a.description||'').substring(0,100))}...</p>
            <div style="display:flex;gap:1rem;font-size:0.8rem;color:var(--text-muted)">
                <span>üë• ${a.recrues?.length||0}</span><span>üìÖ ${a.timeline?.length||0}</span>
            </div>
            <div style="margin-top:1rem;display:flex;gap:0.5rem">
                <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation();duplicateAction('${a.id}')">üìã</button>
                <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation();exportActionById('${a.id}')">üì§</button>
                <button class="btn btn-ghost btn-sm" onclick="event.stopPropagation();deleteAction('${a.id}')">üóëÔ∏è</button>
            </div>
        </div>
    `).join('') : '<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üìã</div>Aucune action<br><button class="btn btn-primary" onclick="showView(\'create\')" style="margin-top:1rem">Cr√©er une action</button></div>';
}

function editAction(id) {
    const action = state.actions.find(a => a.id === id);
    if (action) { fillForm(action); showView('create'); }
}

function duplicateAction(id) {
    const a = state.actions.find(x => x.id === id);
    if (a) {
        state.actions.push({ ...a, id: genId(), titre: a.titre + ' (copie)', createdAt: new Date().toISOString() });
        localStorage.setItem('lr-actions', JSON.stringify(state.actions));
        renderActions();
        renderDashboard();
        toast('Action dupliqu√©e', 'success');
    }
}

function deleteAction(id) {
    if (confirm('Supprimer cette action?')) {
        state.actions = state.actions.filter(a => a.id !== id);
        localStorage.setItem('lr-actions', JSON.stringify(state.actions));
        renderActions();
        renderDashboard();
        toast('Action supprim√©e', 'success');
    }
}

document.getElementById('searchInput')?.addEventListener('input', debounce(renderActions, 300));

// Files
function initFiles() {
    const imports = [
        { icon: 'üìÑ', label: 'JSON', accept: '.json', type: 'json' },
        { icon: 'üìù', label: 'Markdown', accept: '.md', type: 'md' },
        { icon: 'üåê', label: 'HTML', accept: '.html', type: 'html' }
    ];
    const exports = [
        { icon: 'üìÑ', label: 'JSON', type: 'json' },
        { icon: 'üìù', label: 'Markdown', type: 'md' },
        { icon: 'üåê', label: 'HTML', type: 'html' },
        { icon: 'üìÉ', label: 'TXT', type: 'txt' }
    ];
    
    document.getElementById('importGrid').innerHTML = imports.map(f => `
        <label class="file-btn"><input type="file" accept="${f.accept}" style="display:none" onchange="importFile(this,'${f.type}')">
        <span class="file-icon">${f.icon}</span><span class="file-label">${f.label}</span></label>
    `).join('');
    
    document.getElementById('exportGrid').innerHTML = exports.map(f => `
        <button class="file-btn" onclick="exportAction('${f.type}')">
        <span class="file-icon">${f.icon}</span><span class="file-label">${f.label}</span></button>
    `).join('');
}

function importFile(input, type) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        try {
            let data;
            if (type === 'json') data = JSON.parse(e.target.result);
            else if (type === 'md') data = { titre: file.name.replace('.md',''), description: e.target.result };
            else data = { titre: file.name };
            fillForm(data);
            showView('create');
            toast('Fichier import√©', 'success');
        } catch (err) { toast('Erreur d\'import', 'error'); }
    };
    reader.readAsText(file);
    input.value = '';
}

function exportAction(type) {
    const data = getFormData();
    if (!data.titre) return toast('Cr√©ez une action d\'abord', 'error');
    
    let content, filename, mime;
    switch (type) {
        case 'json':
            content = JSON.stringify(data, null, 2);
            filename = `${data.id}.json`;
            mime = 'application/json';
            break;
        case 'md':
            content = `# ${data.titre}\n\n${data.manifeste ? `> ${data.manifeste}\n\n` : ''}${data.description || ''}`;
            filename = `${data.id}.md`;
            mime = 'text/markdown';
            break;
        case 'html':
            content = generateHTML(data);
            filename = `${data.id}.html`;
            mime = 'text/html';
            break;
        case 'txt':
            content = `${data.titre}\n${'='.repeat(40)}\n\n${data.description || ''}`;
            filename = `${data.id}.txt`;
            mime = 'text/plain';
            break;
    }
    
    download(content, filename, mime);
    toast(`Export√© en ${type.toUpperCase()}`, 'success');
}

function exportActionById(id) {
    const a = state.actions.find(x => x.id === id);
    if (a) download(generateHTML(a), `${a.id}.html`, 'text/html');
}

function exportAll() {
    const data = { version: '1.0', exportedAt: new Date().toISOString(), actions: state.actions, settings: { theme: state.theme, typo: state.typo } };
    download(JSON.stringify(data, null, 2), 'lareserve-backup.json', 'application/json');
    toast('Donn√©es export√©es', 'success');
}

function clearAll() {
    if (confirm('Effacer TOUTES les donn√©es?') && confirm('Vraiment s√ªr?')) {
        localStorage.clear();
        state.actions = [];
        renderDashboard();
        renderActions();
        toast('Donn√©es effac√©es', 'success');
    }
}

// Settings
function initSettings() {
    const themes = [
        { id: 'sombre', name: 'Sombre', colors: '#1a1a2e,#16213e' },
        { id: 'clair', name: 'Clair', colors: '#f8f9fa,#e9ecef' },
        { id: 'neon', name: 'N√©on', colors: '#00ff88,#ff0080' },
        { id: 'retrogeek', name: 'Retrogeek', colors: '#2b1b3d,#00ff00' },
        { id: 'console', name: 'Console', colors: '#0c0c0c,#00ff00' },
        { id: 'warroom', name: 'War Room', colors: '#001100,#00ff41' }
    ];
    const typos = [
        { id: 'elegant', name: '√âl√©gant', font: 'Playfair Display' },
        { id: 'editorial', name: '√âditorial', font: 'Syne' },
        { id: 'raw', name: 'Brut', font: 'Fira Code' }
    ];
    
    document.getElementById('themeGrid').innerHTML = themes.map(t => `
        <div class="theme-option ${t.id === state.theme ? 'active' : ''}" onclick="applyTheme('${t.id}')">
            <div class="theme-preview" style="background:linear-gradient(135deg,${t.colors})"></div>
            <div class="theme-name">${t.name}</div>
        </div>
    `).join('');
    
    document.getElementById('typoGrid').innerHTML = typos.map(t => `
        <div class="typo-option ${t.id === state.typo ? 'active' : ''}" onclick="applyTypo('${t.id}')">
            <div class="typo-name" style="font-family:'${t.font}',serif">${t.name}</div>
        </div>
    `).join('');
}

function applyTheme(theme) {
    state.theme = theme;
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('lr-theme', theme);
    document.querySelectorAll('.theme-option').forEach(o => o.classList.toggle('active', o.textContent.toLowerCase().includes(theme)));
}

function applyTypo(typo) {
    state.typo = typo;
    document.documentElement.setAttribute('data-typography', typo);
    localStorage.setItem('lr-typo', typo);
    document.querySelectorAll('.typo-option').forEach(o => o.classList.toggle('active', o.textContent.toLowerCase().includes(typo.substring(0,4))));
}

function cycleTheme() {
    const themes = ['sombre', 'clair', 'neon', 'retrogeek', 'console', 'warroom'];
    const next = themes[(themes.indexOf(state.theme) + 1) % themes.length];
    applyTheme(next);
    toast(`Th√®me: ${next}`, 'success');
}

// War Room
function renderWarroomStats() {
    const targets = [
        { name: 'FOREM', status: 'infiltrated' },
        { name: 'VDAB', status: 'in-progress' },
        { name: 'Actiris', status: 'infiltrated' },
        { name: 'ONEM', status: 'in-progress' },
        { name: 'CPAS', status: 'locked' }
    ];
    document.getElementById('warroomStats').innerHTML = `
        <div class="stat-card" style="border-left:4px solid var(--terminal-green)"><div class="stat-value" style="color:var(--terminal-green)">67%</div><div class="stat-label">Belgique</div></div>
        <div class="stat-card" style="border-left:4px solid var(--terminal-amber)"><div class="stat-value" style="color:var(--terminal-amber)">12%</div><div class="stat-label">Europe</div></div>
        <div class="stat-card" style="border-left:4px solid #06b6d4"><div class="stat-value" style="color:#06b6d4">3%</div><div class="stat-label">Monde</div></div>
        <div class="stat-card"><div class="stat-value">${state.actions.length}</div><div class="stat-label">Actions</div></div>
    `;
}

function launchWarRoom() {
    const overlay = document.getElementById('warroomOverlay');
    overlay.classList.add('active');
    overlay.innerHTML = `
        <div style="display:flex;flex-direction:column;height:100vh;background:#000;color:var(--terminal-green);font-family:'Share Tech Mono',monospace">
            <header style="display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:#001100;border-bottom:2px solid var(--terminal-green)">
                <span style="font-family:'Orbitron',sans-serif;font-size:1.5rem;letter-spacing:0.3em;text-shadow:0 0 10px var(--terminal-green)">LA R√âSERVE</span>
                <span style="color:var(--terminal-amber);font-size:1.2rem" id="wrTime">${new Date().toLocaleTimeString()}</span>
                <button onclick="closeWarRoom()" style="padding:0.5rem 1rem;background:transparent;border:1px solid var(--terminal-red);color:var(--terminal-red);cursor:pointer">FERMER</button>
            </header>
            <main style="flex:1;display:grid;grid-template-columns:1fr 2fr 1fr;gap:2px;padding:2px;background:#002200">
                <div style="background:rgba(0,20,0,0.9);padding:1rem">
                    <h3 style="font-size:0.8rem;letter-spacing:0.1em;margin-bottom:1rem;border-bottom:1px solid rgba(0,255,65,0.3);padding-bottom:0.5rem">üéØ CIBLES</h3>
                    ${['FOREM ‚úì', 'VDAB ‚ö°', 'Actiris ‚úì', 'ONEM ‚ö°', 'CPAS ‚úó'].map(t => `<div style="padding:0.5rem;margin-bottom:0.5rem;background:rgba(0,255,65,0.05);border-left:3px solid ${t.includes('‚úì')?'var(--terminal-green)':t.includes('‚ö°')?'var(--terminal-amber)':'var(--terminal-red)'}">${t}</div>`).join('')}
                </div>
                <div style="background:rgba(0,20,0,0.9);padding:1rem;position:relative">
                    <h3 style="font-size:0.8rem;letter-spacing:0.1em;margin-bottom:1rem">üó∫Ô∏è CARTE TACTIQUE ‚Äî BELGIQUE</h3>
                    <svg viewBox="0 0 400 300" style="width:100%;height:calc(100% - 40px)">
                        <g fill="rgba(0,50,0,0.5)" stroke="var(--terminal-green)" stroke-width="1">
                            <ellipse cx="200" cy="150" rx="150" ry="100"/>
                            <circle cx="200" cy="120" r="20" fill="rgba(0,255,65,0.3)"/>
                        </g>
                        <circle cx="200" cy="120" r="8" fill="var(--terminal-green)"><animate attributeName="r" values="6;10;6" dur="2s" repeatCount="indefinite"/></circle>
                        <text x="220" y="125" fill="var(--terminal-green)" font-size="12">HQ</text>
                    </svg>
                    <div style="position:absolute;top:50%;left:50%;width:200%;height:200%;transform:translate(-50%,-50%);background:conic-gradient(from 0deg,transparent 0deg,rgba(0,255,65,0.1) 30deg,transparent 60deg);animation:sweep 4s linear infinite;pointer-events:none"></div>
                    <style>@keyframes sweep{from{transform:translate(-50%,-50%) rotate(0deg)}to{transform:translate(-50%,-50%) rotate(360deg)}}</style>
                </div>
                <div style="background:rgba(0,20,0,0.9);padding:1rem">
                    <h3 style="font-size:0.8rem;letter-spacing:0.1em;margin-bottom:1rem;border-bottom:1px solid rgba(0,255,65,0.3);padding-bottom:0.5rem">üìä STATS</h3>
                    <div style="text-align:center;padding:1rem;background:rgba(0,255,65,0.1);margin-bottom:1rem"><div style="font-size:2rem;font-weight:bold">67%</div><div style="font-size:0.7rem;opacity:0.7">BELGIQUE</div></div>
                    <div style="font-size:0.75rem" id="wrOps"></div>
                </div>
            </main>
            <footer style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem 2rem;background:#001100;border-top:2px solid var(--terminal-green)">
                <span>‚óè UPTIME: <span id="wrUptime">00:00:00</span></span>
                <span style="color:var(--terminal-amber);animation:marquee 20s linear infinite;white-space:nowrap">‚ö†Ô∏è OP√âRATION WAFFLE EN COURS ‚Äî PHASE 1: BELGIQUE ‚Äî "CE QUI EXISTE D√âJ√Ä MAIS N'A JAMAIS √âT√â RECONNU"</span>
                <button onclick="toast('üåü BASCULEMENT INITI√â','success')" style="padding:0.5rem 1rem;background:transparent;border:1px solid var(--terminal-amber);color:var(--terminal-amber);cursor:pointer">üåü BASCULEMENT</button>
            </footer>
        </div>
        <style>@keyframes marquee{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}</style>
    `;
    
    // Updates
    const start = Date.now();
    const interval = setInterval(() => {
        if (!overlay.classList.contains('active')) { clearInterval(interval); return; }
        document.getElementById('wrTime').textContent = new Date().toLocaleTimeString();
        const s = Math.floor((Date.now() - start) / 1000);
        document.getElementById('wrUptime').textContent = `${String(Math.floor(s/3600)).padStart(2,'0')}:${String(Math.floor((s%3600)/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
    }, 1000);
}

function closeWarRoom() {
    document.getElementById('warroomOverlay').classList.remove('active');
}

// Guide
function renderGuide() {
    document.getElementById('guideContent').innerHTML = `
        <h1>üìñ Guide de La R√©serve</h1>
        <h2>üé≠ Concept</h2>
        <p><strong>La R√©serve</strong> est un ARG (Alternate Reality Game) participatif sur l'emploi et la bureaucratie en Belgique.</p>
        <blockquote>¬´ Ce qui existe d√©j√† mais n'a jamais √©t√© reconnu ¬ª</blockquote>
        
        <h2>‚öôÔ∏è Comment √ßa marche ?</h2>
        <h3>1. D√©tourner</h3>
        <p>Cr√©ez une action en d√©tournant une offre d'emploi, un formulaire administratif, ou tout document bureaucratique.</p>
        
        <h3>2. Recruter</h3>
        <p>Constituez une √©quipe de 9 recrues maximum :</p>
        <ul>
            <li><strong>Complice</strong> üü£ ‚Äî Participe activement</li>
            <li><strong>Figurant¬∑e</strong> üîµ ‚Äî Appara√Æt sans contexte</li>
            <li><strong>T√©moin</strong> üü° ‚Äî Observe et documente</li>
            <li><strong>Expert¬∑e</strong> üü¢ ‚Äî Apporte une expertise</li>
        </ul>
        
        <h3>3. Documenter</h3>
        <p>Construisez une timeline d√©taill√©e avec les √©tapes de votre action.</p>
        
        <h3>4. Basculer</h3>
        <p>Si votre action rencontre un succ√®s, elle peut "basculer" du fictif vers le r√©el.</p>
        
        <h2>üö´ Limites</h2>
        <p>Seules contraintes : <strong>le droit r√©el</strong> et <strong>les al√©as de la vie</strong>.</p>
        
        <h2>üéõÔ∏è War Room</h2>
        <p>Le centre de commandement tactique permet de visualiser la progression du "piratage pacifique" de la Belgique.</p>
    `;
}

// Modals
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

document.querySelectorAll('.modal-overlay').forEach(m => {
    m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); });
});
document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active')); });

// Toast
function toast(msg, type = 'info') {
    const container = document.getElementById('toastContainer');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `<span>${{success:'‚úÖ',error:'‚ùå',warning:'‚ö†Ô∏è',info:'‚ÑπÔ∏è'}[type]||'‚ÑπÔ∏è'}</span><span>${msg}</span>`;
    container.appendChild(t);
    setTimeout(() => { t.style.animation = 'toastIn 0.3s reverse'; setTimeout(() => t.remove(), 300); }, 3000);
}

// Utils
function genId() { return 'LR-' + Math.random().toString(36).substr(2, 9).toUpperCase(); }
function esc(s) { return s ? String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) : ''; }
function formatDate(d) { try { return new Date(d).toLocaleDateString('fr-BE', { day: 'numeric', month: 'short', year: 'numeric' }); } catch { return d; } }
function debounce(fn, ms) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; }
function download(content, filename, mime) {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([content], { type: mime }));
    a.download = filename;
    a.click();
}

function insertMd(type) {
    const ta = document.getElementById('actionDescription');
    const s = ta.selectionStart, e = ta.selectionEnd, txt = ta.value, sel = txt.substring(s, e);
    const wrap = { bold: ['**', '**'], italic: ['_', '_'], heading: ['## ', ''], list: ['- ', ''], link: ['[', '](url)'] };
    const [b, a] = wrap[type] || ['', ''];
    ta.value = txt.substring(0, s) + b + (sel || 'texte') + a + txt.substring(e);
    ta.focus();
    updatePreview();
}

function parseMd(t) {
    return t.replace(/^### (.*)$/gm, '<h3>$1</h3>').replace(/^## (.*)$/gm, '<h2>$1</h2>').replace(/^# (.*)$/gm, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/_(.*?)_/g, '<em>$1</em>')
        .replace(/^- (.*)$/gm, '<li>$1</li>').replace(/\n/g, '<br>');
}

// Keyboard shortcuts
document.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 's') { e.preventDefault(); if (state.view === 'create') saveAction(); }
    if ((e.ctrlKey || e.metaKey) && e.key === 'n') { e.preventDefault(); resetEditor(); showView('create'); }
});

console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    LA R√âSERVE v1.0                        ‚ïë
‚ïë     ¬´ Ce qui existe d√©j√† mais n'a jamais √©t√© reconnu ¬ª    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
`);
    </script>
</body>
</html>
